{# DATATABLE #}
{# Style: Bootstrap 4 #}
{# Extensions: Buttons, Responsive, SearchPanes#}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap4.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.bootstrap4.min.css"/>
<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap4.min.css"/>
<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/searchpanes/2.1.0/css/searchPanes.bootstrap4.min.css"/>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.bootstrap4.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.colVis.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.print.min.js"></script>
<script type="text/javascript"
        src="https://cdn.datatables.net/responsive/2.4.0/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.4.0/js/responsive.bootstrap4.js"></script>
<script type="text/javascript"
        src="https://cdn.datatables.net/searchpanes/2.1.0/js/dataTables.searchPanes.min.js"></script>
<script type="text/javascript"
        src="https://cdn.datatables.net/searchpanes/2.1.0/js/searchPanes.bootstrap4.min.js"></script>

{# Datatable Internacionalización #}
<script src="https://cdn.datatables.net/plug-ins/1.12.1/i18n/es-ES.json"></script>
<script>
    let tables = document.querySelectorAll('table');

    for (let i = 0; i < tables.length; i++) {
        $(tables[i]).DataTable({
            responsive: true,
            lengthChange: false,
            autoWidth: false,
            // Quitarle estilos a la ultima columna
            columnDefs: [
                {"orderable": false, "targets": -1}
            ],
            buttons: [
                {
                    extend: 'print',
                    exportOptions: {
                        // Impresión de todas las columnas excepto la última
                        columns: ':not(:last-child)'
                    }
                },
                {
                    extend: 'pdf',
                    exportOptions: {
                        columns: ':not(:last-child)',
                        footer: true
                    },
                    footer: function (currentPage, pageCount) {
                        return currentPage.toString() + ' of ' + pageCount;
                    },
                    customize:
                        function (doc) {
                            doc.content[1].table.widths = ['10%', '20%', '20%', '20%', '20%', '10%'];
                            doc.styles.tableBodyEven.alignment = 'center';
                            doc.styles.tableBodyOdd.alignment = 'center';
                            doc.styles.tableFooter.alignment = 'center';
                            doc['footer'] = (function (page, pages) {
                                return {
                                    columns: [
                                        {
                                            alignment: 'left',
                                            text: ['Página ', {text: page.toString()}, ' de ', {text: pages.toString()}]
                                        },
                                        {
                                            alignment: 'right',
                                            text: ['Fecha: ', {text: new Date().toLocaleString()}]
                                        }
                                    ],
                                    margin: [10, 0]
                                }
                            });
                        }
                },
                {
                    extend: 'colvis',
                    text: 'Columnas visibles',
                    columns: ':gt(0)',
                    postfixButtons: ['colvisRestore']
                }
            ],
            language: {
                search: "Buscar:",
                lengthMenu: "Mostrar _MENU_ registros por página",
                zeroRecords: "No se encontraron registros",
                info: "Mostrando página _PAGE_ de _PAGES_",
                infoEmpty: "No hay registros disponibles",
                infoFiltered: "(filtrado de _MAX_ registros totales)",
                paginate: {
                    first: "Primero",
                    last: "Último",
                    next: "Siguiente",
                    previous: "Anterior"
                },
                buttons: {
                    colvis: 'Columnas',
                    print: 'Imprimir',
                    copy: 'Copiar',
                    copyTitle: 'Copiado al portapapeles',
                    copySuccess: {
                        _: '%d líneas copiadas',
                        1: '1 línea copiada'
                    },
                    colvisRestore: 'Restaurar'
                },
            }
        });
        // Datatable buttons bootstrap 4, append buttons
        $(tables[i]).DataTable().buttons().container().appendTo('#' + tables[i].id + '_wrapper .col-md-6:eq(0)');
    }
</script>